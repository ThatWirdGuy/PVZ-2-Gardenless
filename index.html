<!DOCTYPE html>

<!-- Ultimate Game Stash file--> 
<!-- For the regularly updating doc go to https://docs.google.com/document/d/1_FmH3BlSBQI7FGgAQL59-ZPe8eCxs35wel6JUyVaG8Q/ -->

<html>

<head>
  <meta charset="utf-8">
  <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/gardenless/">
  <title>PvZ2 Gardendless Online | 0.6.0</title>

  <script>
  (function() {
    const originalImage = window.Image;
    window.Image = function() {
      const img = new originalImage();
      img.crossOrigin = 'anonymous';
      return img;
    };
  })();
  </script>

  <!-- ===== CHROMEBOOK + INVISIBLE LEVEL UI FIX (MERGED) ===== -->
  <script>
  (function () {
    const isChromeOS = /CrOS/i.test(navigator.userAgent);
    if (!isChromeOS) return;

    console.log("ChromeOS detected â€“ applying UI fixes");

    function applyFixes() {
      const canvas = document.getElementById("GameCanvas");
      const gameDiv = document.getElementById("GameDiv");
      if (!canvas) return;

      /* =====================================================
         CRITICAL FIX:
         Force DPR = 1 to prevent invisible level UI
         ===================================================== */
      const w = window.innerWidth;
      const h = window.innerHeight;

      canvas.style.width = w + "px";
      canvas.style.height = h + "px";
      canvas.width = w;
      canvas.height = h;

      canvas.style.position = "absolute";
      canvas.style.left = "0";
      canvas.style.top = "0";
      canvas.style.zIndex = "1";

      /* Keyboard / mouse focus */
      canvas.setAttribute("tabindex", "1");
      canvas.focus({ preventScroll: true });

      document.addEventListener("click", () => canvas.focus());
      document.addEventListener("keydown", () => canvas.focus());

      /* Disable ChromeOS gestures */
      if (gameDiv) {
        gameDiv.style.touchAction = "none";
        gameDiv.addEventListener("contextmenu", e => e.preventDefault());
      }

      /* =====================================================
         FORCE COCOS UI REFRESH (fixes invisible level buttons)
         ===================================================== */
      function refreshCocosUI() {
        if (window.cc && cc.view) {
          cc.view.enableAutoFullScreen(false);
          cc.view.resizeWithBrowserSize(true);
          cc.view.setDesignResolutionSize(
            window.innerWidth,
            window.innerHeight,
            cc.ResolutionPolicy.SHOW_ALL
          );
          cc.view._resizeEvent();
        }
      }

      /* Run multiple times to catch late UI creation */
      setTimeout(refreshCocosUI, 500);
      setTimeout(refreshCocosUI, 1000);
      setTimeout(refreshCocosUI, 2000);

      /* Audio unlock (ChromeOS policy) */
      function unlockAudio() {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        const ctx = new AC();
        if (ctx.state === "suspended") ctx.resume();
      }

      document.addEventListener("mousedown", unlockAudio, { once: true });
      document.addEventListener("touchstart", unlockAudio, { once: true });
      document.addEventListener("keydown", unlockAudio, { once: true });

      /* Keep canvas synced on resize */
      window.addEventListener("resize", () => {
        const w = window.innerWidth;
        const h = window.innerHeight;
        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
        canvas.width = w;
        canvas.height = h;
        refreshCocosUI();
      });
    }

    window.addEventListener("load", applyFixes);
  })();
  </script>
  <!-- ===== END CHROMEBOOK FIX ===== -->

  <meta name="viewport"
    content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">

  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="msapplication-tap-highlight" content="no">

  <meta name="full-screen" content="yes" />
  <meta name="x5-fullscreen" content="true" />
  <meta name="360-fullscreen" content="true" />
  <meta name="x5-page-mode" content="app">

  <link rel="stylesheet" type="text/css" href="style.f76d1.css" />

</head>

<body>
  <div id="GameDiv" cc_exact_fit_screen="true">
    <div id="Cocos3dGameContainer">
      <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="99"></canvas>
    </div>
  </div>

  <script src="src/polyfills.bundle.5adbf.js"></script>
  <script src="src/system.bundle.543e6.js"></script>
  <script src="src/import-map.4399c.json" type="systemjs-importmap"></script>

  <script>
    System.import('./index.bed7f.js').catch(err => console.error(err));
  </script>

  <script src="tmpPatch.js"></script>
</body>
</html>
