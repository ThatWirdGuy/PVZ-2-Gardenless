<!DOCTYPE html>

<!-- Ultimate Game Stash file--> 
<!-- For the regularly updating doc go to https://docs.google.com/document/d/1_FmH3BlSBQI7FGgAQL59-ZPe8eCxs35wel6JUyVaG8Q/ -->

<html>

<head>
  <meta charset="utf-8">
  <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/gardenless/">
  <title>PvZ2 Gardendless Online | 0.6.0</title>

  <script>
  (function() {
    const originalImage = window.Image;
    window.Image = function() {
      const img = new originalImage();
      img.crossOrigin = 'anonymous';
      return img;
    };
  })();
  </script>

  <!-- ===== Chromebook / ChromeOS FIX (MERGED) ===== -->
  <script>
  (function () {
    const isChromeOS = /CrOS/i.test(navigator.userAgent);
    if (!isChromeOS) return;

    console.log("ChromeOS detected â€“ fixes enabled");

    function applyFixes() {
      const canvas = document.getElementById("GameCanvas");
      const gameDiv = document.getElementById("GameDiv");
      if (!canvas) return;

      /* Keyboard focus */
      canvas.setAttribute("tabindex", "1");
      canvas.focus({ preventScroll: true });

      document.addEventListener("click", () => canvas.focus());
      document.addEventListener("keydown", () => canvas.focus());

      /* Proper canvas scaling */
      function resize() {
        const dpr = window.devicePixelRatio || 1;
        const w = window.innerWidth;
        const h = window.innerHeight;

        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
      }

      window.addEventListener("resize", resize);
      window.addEventListener("orientationchange", resize);
      resize();

      /* Unlock audio (ChromeOS autoplay policy) */
      function unlockAudio() {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        const ctx = new AC();
        if (ctx.state === "suspended") ctx.resume();
      }

      document.addEventListener("mousedown", unlockAudio, { once: true });
      document.addEventListener("touchstart", unlockAudio, { once: true });
      document.addEventListener("keydown", unlockAudio, { once: true });

      /* Disable right-click & gestures */
      if (gameDiv) {
        gameDiv.addEventListener("contextmenu", e => e.preventDefault());
        gameDiv.style.touchAction = "none";
      }
    }

    window.addEventListener("load", applyFixes);
  })();
  </script>
  <!-- ===== END Chromebook FIX ===== -->

  <meta name="viewport"
    content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">

  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="msapplication-tap-highlight" content="no">

  <meta name="full-screen" content="yes" />
  <meta name="x5-fullscreen" content="true" />
  <meta name="360-fullscreen" content="true" />
  <meta name="x5-page-mode" content="app">

  <link rel="stylesheet" type="text/css" href="style.f76d1.css" />

  <!-- Google scripts untouched -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FNC28KV0ZR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FNC28KV0ZR');
  </script>

</head>

<body>
  <div id="GameDiv" cc_exact_fit_screen="true">
    <div id="Cocos3dGameContainer">
      <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="99"></canvas>
    </div>
  </div>

  <script src="src/polyfills.bundle.5adbf.js"></script>
  <script src="src/system.bundle.543e6.js"></script>
  <script src="src/import-map.4399c.json" type="systemjs-importmap"></script>

  <script>
    System.import('./index.bed7f.js').catch(err => console.error(err));
  </script>

  <script src="tmpPatch.js"></script>
</body>
</html>
